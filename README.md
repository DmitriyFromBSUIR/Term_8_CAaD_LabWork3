# Term_8_CAaD_LabWork3
Computer Architecture &amp; Design Lab #3 - Auto-Vectorization, OpenMP, Hand-made Vectorization, Processor's Instructions Latency and Capacity Throughput

Исследование латентности и пропускной способности инструкций

Краткие теоретические сведения:

    Введение

    1. Латентность и пропускная способности инструкций

    2. Методика измерения латентности и пропускной способности инструкций

Задание к лабораторной работе

Требования к защите

   Введение

   Все современные процессоры исполняют инструкции на конвейере. Также конвейеризированными являются и вычислительные устройства процессора. Параметры латентность и пропускная способность являются основными характеристиками конвейера.

   Латентность определяется как количество тактов, которое необходимо данным, чтобы пройти конвейер от начала до конца.

   Пропускная способность конвейера – это количество тактов, через которое на конвейер можно подавать новые данные. В общем случае для конвейера пропускная способность равна 1, так как на полностью конвейеризированное устройство данные можно подавать каждый такт.


     1. Латентность и пропускная способности инструкций

   Латентность и пропускная способность инструкций определяется через термины зависимых и независимых по данным инструкций. Инструкция зависит по данным от другой инструкции, если использует ее результат в качестве своих аргументов.

   Латентность инструкции – это количество тактов от момента запуска инструкции до момента, когда следующая за ней зависимая инструкция получит данные и сможет запуститься. С одной стороны на этот параметр влияет длина вычислительного конвейера для данной инструкции, а с другой микроархитектура процессора.

   Пропускная способность инструкции - это количество тактов, через которое процессор может запустить следующую независимую инструкцию того же типа. В отличие от этой характеристики для конвейера значения, может быть меньше 1. Например, значение 0,5 обозначает, что процессор может запустить две независимые инструкции в один такт.


     2. Методика измерения латентности и пропускной способности инструкций

   Выполняется через определение времени исполнения определенной смеси инструкций. Замер времени производится инструкцией RDTSC. Так как нам собственно неважно само время, а важно, сколько тактов исполнялся код то RDTSC подходит идеально.

   Для измерения латентности инструкции нужно составить код, который состоит из цепочки зависимых инструкций. Например, надо измерить латентность инструкции add, можно написать такую цепочку:

	add eax,ebx
	add eax,ebx
	add eax,ebx
	add eax,ebx

   Этот код лучше повторить несколько десятков раз, перед тем как сформировать цикл. Инструкции, которые формирую цикл, тоже занимают время, поэтому при слишком коротком теле цикла они будут существенно искажать измеряемый результат.

   Измерение пропускной способности происходит аналогично, только меняется последовательность инструкций. Требуется сформировать последовательность из независимых инструкций. Максимальное количество независимых инструкций определяется количеством доступных регистров. В архитектуре x86, всего 8 регистров, что позволяет сформировать 7 независимых инструкций. Рассмотрим пример на основе инструкций add.

	add ebx, eax
	add ecx, eax
	add edx, eax
	add esi, eax
	add edi, eax

   Для того, чтобы корректно измерить пропускную способность нужно чтобы количество независимых инструкций в наборе было не меньше чем L/T, где L – латентность инструкции, а T – пропускная способность. Например, если L=3, а T = 0.5, то требуется 6 независимых инструкций. То есть для некоторых инструкций измерить пропускную способность не возможно в рамках архитектуры х86. В этом случае можно скомпилировать приложение под архитектуру x86-64. Эта архитектура обладает 16 регистрами, что дает возможность написать 15 независимых инструкций.

   Пропускная способность определяется как количество прошедших тактов деленое на общее количество исполненных инструкций.

Задание к лабораторной работе:

   Разработать консольное приложение для измерения латентности и пропускной способности для инструкции, которую выдал преподаватель.
Требования к защите:

    выполнить требуемые измерения (латентность и пропускную способность);
    сравнить результаты со значениями из спецификации процессора.
